---
import groq from "groq";
import Layout from "@/layout/Layout.astro";
import { sanityClient } from "@lib/sanityClient.ts";

export async function getStaticPaths() {
    const slugs = await sanityClient.fetch(groq`*[_type=="useCase" && defined(slug.current)]{ "slug": slug.current }`);
    return slugs.map((s: any) => ({ params: { slug: s.slug } }));
}

const { slug } = Astro.params;

const useCase = (await sanityClient.fetch(
    groq`*[_type=="useCase" && slug.current==$slug][0]{
    title,
    "slug": slug.current,
    heroHeadline,
    subheadline,
    proofPoints,
    momentBullets,
    stakes,
    ahaMoment,
    timeToValue,
    firstRunChecklist,
    howItWorks[]{ title, description },
    evidenceBlocks[]{
      type, claim, measurement,
      asset,
      linkToExample->{
        title,
        "slug": slug.current
      }
    },
    faq[]{ q, a },
    primaryCta{ label, href },
    secondaryCta{ label, href },
    relatedUseCases[]->{
      title,
      "slug": slug.current,
      heroHeadline
    }
  }`,
    { slug }
)) || {
    title: "Use Case",
    heroHeadline: "Ready to solve your challenges",
    subheadline: "Ctxfy helps you navigate complex workflows with ease.",
    momentBullets: ["Difficulty in tracking", "Context loss", "Manual errors"],
    stakes: "high",
    howItWorks: [
        { title: "Step 1", description: "Integrate Ctxfy into your workflow." },
        { title: "Step 2", description: "Analyze your context data." },
        { title: "Step 3", description: "Optimize and scale." }
    ],
    primaryCta: { label: "Get Started", href: "/signup" }
};
---

<Layout title={useCase?.title ?? "Use case"}>
    <main class="container section" style="padding-top: 120px;" data-use-case={useCase?.slug}>
        <section>
            <h1 class="section-title">{useCase?.heroHeadline}</h1>
            <p class="section-copy">{useCase?.subheadline}</p>

            <div style="display: flex; gap: 12px; margin-bottom: 32px;">
                {useCase?.primaryCta?.href && (
                    <a href={useCase.primaryCta.href} class="btn-primary">{useCase.primaryCta.label}</a>
                )}
                {useCase?.secondaryCta?.href && (
                    <a href={useCase.secondaryCta.href} class="nav-pill">{useCase.secondaryCta.label}</a>
                )}
            </div>

            {useCase?.proofPoints?.length ? (
                    <ul class="feature-row" style="list-style: none; padding: 0;">
                        {useCase.proofPoints.map((p: string) => (
                            <li class="feature-pill">
                                <span class="feature-icon">âœ“</span>
                                {p}
                            </li>
                        ))}
                    </ul>
            ) : null}
        </section>

        <section class="section">
            <h2 class="section-title">When this hits</h2>
            <ul class="offer-grid" style="list-style: none; padding: 0;">
                {useCase?.momentBullets?.map((b: string) => (
                    <li class="offer-card">
                        <p class="offer-text">{b}</p>
                    </li>
                ))}
            </ul>
            <p style="margin-top: 24px;"><strong>Stakes:</strong> <span class="pricing-badge">{useCase?.stakes}</span></p>
        </section>

        <section class="section">
            <h2 class="section-title">How it works</h2>
            <div class="offer-grid">
                {useCase?.howItWorks?.map((s: any, idx: number) => (
                        <div class="offer-card">
                            <div class="brand-badge" style="margin-bottom: 12px;">{idx + 1}</div>
                            <h3 class="offer-title">{s.title}</h3>
                            <p class="offer-text">{s.description}</p>
                        </div>
                ))}
            </div>
        </section>

        {useCase.evidenceBlocks?.length ? (
                <section>
                    <h2>Proof</h2>
                    <ul>
                        {useCase.evidenceBlocks.map((e: any) => (
                                <li>
                                    <strong>{e.claim}</strong>
                                    {e.measurement ? <p>{e.measurement}</p> : null}
                                    {e.linkToExample?.slug ? <a href={`/examples/${e.linkToExample.slug}/`}>See example</a> : null}
                                </li>
                        ))}
                    </ul>
                </section>
        ) : null}

        {useCase.faq?.length ? (
                <section>
                    <h2>FAQ</h2>
                    {useCase.faq.map((f: any) => (
                            <details>
                                <summary>{f.q}</summary>
                                <p>{f.a}</p>
                            </details>
                    ))}
                </section>
        ) : null}

        {useCase.relatedUseCases?.length ? (
                <section>
                    <h2>Related use cases</h2>
                    <ul>
                        {useCase.relatedUseCases.map((r: any) => (
                                <li>
                                    <a href={`/use-cases/${r.slug}`}>{r.title}</a>
                                </li>
                        ))}
                    </ul>
                </section>
        ) : null}
    </main>
</Layout>
